{{ 'base.css' | asset_url |stylesheet_tag }}

{% assign cont_width = '' %}
{% assign column_width = '' %}
{% case section.settings.section_width %}
  {% when 'large' %}
    {% assign cont_width = '1024px' %}
    {% assign column_width = 'calc(1024px / ' | append: section.settings.columns | append: ')' %}
  {% when 'medium' %}
    {% assign cont_width = '768px' %}
    {% assign column_width = 'calc(768px / ' | append: section.settings.columns | append: ')' %}
  {% when 'small' %}
    {% assign cont_width = '640px' %}
    {% assign column_width = 'calc(640px / ' | append: section.settings.columns | append: ')' %}
  {% else %}
    {% assign column_width = 'calc(100% / ' | append: section.settings.columns | append: ')' %}
    {% assign cont_width = '100%' %}
{% endcase %}

<section class="px-4 max-w-6xl mx-auto">
    <div id="margin-container" style="margin-top: {{ section.settings.margin_top }}; margin-bottom: {{ section.settings.margin_bottom }}">
        {%  render 'section-title',
            title: section.settings.heading
        %}
      
        {% assign blog_handle = section.settings.blog | default: 'news' %}
        {% assign blog = blogs[blog_handle] %}
        
        {% if blog.articles.size > 0 %}
          {% comment %} Desktop Version {% endcomment %}
          <div class="hidden lg:flex flex-wrap flex-row items-start justify-center" style="width: {{ cont_width }}">
            {% for article in blog.articles limit: section.settings.post_limit %}
                <div style="width: {{ column_width }}" class="p-4" >
                    <a href="{{ article.url }}" class="flex flex-col items-center justify-center">
                        
                        {% if article.url %}
                            <div id="article-img" style="background-image:url({{ article.image | image_url: height:500 }}); background-repeat: no-repeat; height: {{ 900 | divided_by: section.settings.columns }} "  class="object-cover object-center w-full">
                            </div>
                        {% endif %}
                        <div id="content-container" class="mt-4">
                             <h3 class="text-xl font-semibold mb-2">
                                <a href="{{ article.url }}">{{ article.title }}</a>
                            </h3>
                
                            <p class="text-sm text-gray-600 mb-4">
                                {{ article.excerpt | strip_html | truncatewords: 20 }}
                            </p>
                            <div id="column-btn">
                                <a class="transition-all duration-300 hover:opacity-80"
                                    href="{{ article.url }}"
                                    style="color: {{ section.settings.button_text_color }};">
                                    <span class="button-span flex flex-row items-center gap-x-2 transform transition-all duration-150">
                                        {{ section.settings.read_more_label }}
                                    </span>
                                </a>
                            </div>
                        </div>
                    </a>
                </div>
            {% endfor %}
          </div>

          {% comment %} Mobile Version {% endcomment %}
          <div class="flex lg:hidden flex-col gap-y-4 items-start justify-center w-full">
            {% for article in blog.articles limit: section.settings.post_limit %}
                <div class="p-4 w-full" >
                    <a href="{{ article.url }}" class="flex flex-col items-center justify-center">
                        
                        {% if article.url %}
                            <div id="article-img" class="bg-red-300 w-[390px] h-[390px] overflow-hidden">
                              <img class="object-cover object-center w-[390px] h-[390px]" src="{{ article.image | image_url: height:500 }}" height="390" width="390">
                            </div>
                        {% endif %}
                        <div id="content-container" class="mt-4">
                             <h3 class="text-xl font-semibold mb-2">
                                <a href="{{ article.url }}">{{ article.title }}</a>
                            </h3>
                
                            <p class="text-sm text-gray-600 mb-4">
                                {{ article.excerpt | strip_html | truncatewords: 20 }}
                            </p>
                            <div id="column-btn">
                                <a class="transition-all duration-300 hover:opacity-80"
                                    href="{{ article.url }}"
                                    style="color: {{ section.settings.button_text_color }};">
                                    <span class="button-span flex flex-row items-center gap-x-2 transform transition-all duration-150">
                                        {{ section.settings.read_more_label }}
                                    </span>
                                </a>
                            </div>
                        </div>
                    </a>
                </div>
            {% endfor %}
          </div>
        {% else %}
          <p>No blog posts found.</p>
        {% endif %}
    </div>
</section>


{% schema %}
{
  "name": "Featured Blog Posts",
  "tag": "section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "From Our Blog"
    },
    {
      "type": "blog",
      "id": "blog",
      "label": "Select Blog"
    },
    {
        "type":"select",
        "id": "section_width",
        "label": "Section Width",
        "default": "large",
        "options": [
            {
                "value": "full",
                "label": "Full Width"
            },
            {
                "value": "large",
                "label": "Large (1024px)"
            },
            {
                "value": "medium",
                "label": "Medium (768px)"
            },
            {
                "value": "small",
                "label": "Small (640px)"
            }
        ]
    },
    {
      "type": "range",
      "id": "post_limit",
      "label": "Number of posts",
      "min": 1,
      "max": 6,
      "default": 3
    },
    {
      "type": "range",
      "id": "columns",
      "label": "Number of columns",
      "min": 1,
      "max": 3,
      "default": 3
    },
    {
      "type": "text",
      "id": "read_more_label",
      "label": "Read More Label",
      "default": "Read More â†’"
    },
    {
        "type":"color",
        "id": "button_text_color",
        "label": "Button Text Color",
        "default": "#c9c9c9"
    },
    {
        "type":"header",
        "content": "Margin Settings"
    },
    {
        "type":"range",
        "id": "margin_top",
        "label":"Top Margin",
        "max": 100,
        "min": 0,
        "step": 1,
        "default": 16
    },
    {
        "type":"range",
        "id": "margin_bottom",
        "label":"Bottom Margin",
        "max": 100,
        "min": 0,
        "step": 1,
        "default": 16
    }
  ],
  "presets": [
    {
      "name": "Featured Blog Posts",
      "category": "Blog"
    }
  ]
}
{% endschema %}
