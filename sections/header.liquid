{% assign menu_link = linklists[section.settings.menu_links] %}

<!-- Header Section -->
<header class="sticky top-0 z-50 shadow" style="background-color: {{ section.settings.header_bgcolor }}">
    <div class="flex justify-between items-center h-16 p-4">
        <div id="header-logo">
            <a href="{{ shop.url }}" title="{{ shop.name }}">
                <img src="{{ settings.logo_image | image_url: width: settings.logo_width }}" alt="{{ shop.name }}" width="{{ settings.logo_width }}" height="{{ settings.logo_height }}" />
            </a>
        </div>
        <div id="header-menu-desktop" class="hidden md:flex gap-x-2 items-center justify-center">
            {% for link in menu_link.links %}
                <div class="relative group p-4">
                    <a href="{{ link.url }}" class="block decoration-0 w-full h-full" title="{{ link.title }}">
                        {{ link.title }}
                    </a>
                    {% if link.links.size > 0 %}
                        <div class="absolute left-0 top-full min-w-[160px] w-54 bg-white shadow-lg rounded transition-all duration-300 opacity-0 scale-y-95 group-hover:opacity-100 group-hover:scale-y-100 pointer-events-none group-hover:pointer-events-auto z-10">
                            {% for sublink in link.links %}
                                <a href="{{ sublink.url }}" class="block px-4 py-2 hover:bg-gray-100 transition-colors duration-200" title="{{ sublink.title }}">
                                    {{ sublink.title }}
                                </a>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
        <div id="header-menu-mobile" class="flex md:hidden items-center justify-center">
            <div id="menu-btn">
                <div id="svg-wrapper">
                    <svg fill="#000000" width="24px" height="24px" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
                        <title>bars</title>
                        <path d="M2 8.749h28c0.414 0 0.75-0.336 0.75-0.75s-0.336-0.75-0.75-0.75v0h-28c-0.414 0-0.75 0.336-0.75 0.75s0.336 0.75 0.75 0.75v0zM30 15.25h-28c-0.414 0-0.75 0.336-0.75 0.75s0.336 0.75 0.75 0.75v0h28c0.414 0 0.75-0.336 0.75-0.75s-0.336-0.75-0.75-0.75v0zM30 23.25h-28c-0.414 0-0.75 0.336-0.75 0.75s0.336 0.75 0.75 0.75v0h28c0.414 0 0.75-0.336 0.75-0.75s-0.336-0.75-0.75-0.75v0z"></path>
                    </svg>
                </div>
            </div>
            <div id="mobile-menu-modal" class="side-panel fixed top-0 w-full h-screen z-50 p-4" style="background-color: {{ section.settings.mobile_menu_bgcolor }}">
                <div id="menu-close-btn" class="w-full flex items-end justify-end">
                    <svg width="32px" height="32px" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M1.5 1.5L13.5 13.5M1.5 13.5L13.5 1.5" stroke="#000000"/>
                    </svg>
                </div>
                <div id="menu-item" class="w-full flex flex-col gap-y-2 ">
                    {% for link in menu_link.links %}
                        <a href="{{ link.url }}" class="py-2 text-center text-xl" title="{{ link.title }}">
                            {{ link.title }}
                        </a>
                        {% if link.links.size > 0 %}
                            {% for sublink in link.links %}
                                <a href="{{ sublink.url }}" class="text-center my-2 opacity-70 text-sm" title="{{ sublink.title }}">
                                    {{ sublink.title }}
                                </a>
                            {% endfor %}
                        {% endif %}
                        <hr class="opacity-50 w-5/6 mx-auto"/>
                    {%  endfor %} 
                </div>
            </div>
        </div>
    </div>
</header>

<style>
    .side-panel {
        right: -100%;
        transition: right 0.3s ease;
    }

    .side-panel.show-panel {
        right: 0%; 
    }
    
    /* Optional: Animate dropdown */
    .dropdown-enter {
        opacity: 0;
        transform: translateY(-5px);
    }
    .dropdown-enter-active {
        opacity: 1;
        transform: translateY(0);
        transition: all 0.2s ease;
    }
</style>

<script>
    const menuBtn = document.getElementById('menu-btn');
    const closeBtn = document.getElementById('menu-close-btn');
    const menuModal = document.getElementById('mobile-menu-modal');

    
    menuBtn.addEventListener('click', () => {
        menuModal.classList.toggle('show-panel');
    });
    
    closeBtn.addEventListener('click', () => {
        menuModal.classList.toggle('show-panel');
    });


    document.querySelectorAll('#header-menu-desktop .group').forEach(function(group) {
                const dropdown = group.querySelector('.absolute');
                if (dropdown) {
                    group.addEventListener('mouseenter', function() {
                        gsap.to(dropdown, { opacity: 1, scaleY: 1, duration: 0.2, ease: "power2.out" });
                    });
                    group.addEventListener('mouseleave', function() {
                        gsap.to(dropdown, { opacity: 0, scaleY: 0.95, duration: 0.2, ease: "power2.in" });
                    });
                }
            });
</script>


{% schema %}
{
    "name": "Header",
    "settings": [
        {
            "type": "link_list",
            "id": "menu_links",
            "label": "Menu List",
            "default": "main-menu"
        },
        {
            "type": "color",
            "id": "header_bgcolor",
            "label": "Header Background Color",
            "default": "#ffffff"
        },
        {
            "type":"header",
            "content": "Mobile Settings"
        },
        {
            "type": "color",
            "id": "mobile_menu_bgcolor",
            "label": "Menu Background Color",
            "default": "#e2e6ea"
        }
    ],
    "presets": [
        {
            "name": "Header",
            "category": "Header",            
        }
    ]
}
{% endschema %}
